<!DOCTYPE HTML>
<html>

<head>
 <title>Panther</title>
 <META http-equiv="Pragma" content="no-cache">
 <META http-equiv="Expires" content="-1">
 <META http-equiv="Content-Type" content="text/html; charset=utf-8">
 <SCRIPT src="common.js"></SCRIPT>
 <SCRIPT src="wdk.js"></SCRIPT>
 <SCRIPT src="product.js"></SCRIPT>
 <link rel="stylesheet" type="text/css" href="demo2.css">
 <script type="text/javascript">
wdk.cdbLoad([
	'$pandora_user',
	'$pandora_password',
	'$pandora_proxy',
	'$pandora_license'
]);

var check_login = 0;
var LOGIN = "0";
var station_list = new Array();
var play_station = 0;

function sleep(milliseconds) {
	var start = new Date().getTime();
	for (var i = 0; i < 1e7; i++) {
		if ((new Date().getTime() - start) > milliseconds) {
			break;
		}
	}
}

function check_button_state() {
	if (LOGIN == "1") {
		showHide("lin", 0);
		showHide("lout", 1);
	} else {
		showHide("lin", 1);
		showHide("lout", 0);
	}
}

function check_login_status() {
	check_login++;

	LOGIN = wdk.cliCmd("pandora get_login_status").replace("\n", "");

	if (LOGIN == "1") {
		sleep(3000);
		show_stations();
		sleep(3000);
		show_info();
		playsong(0);
		check_button_state();
		wdk.hideResultBG();
		check_login = 0;
		return;
	}

	if (check_login < 20) {
		setTimeout("check_login_status()", 1000);
	} else {
		wdk.hideResultBG();
		alert(wdk.msg("login fail, please check internet connection and account information."));
		check_login = 0;
	}
}

function login() {
	var _user;
	var _passwd;
	var _proxy;
	var _license;

	if (wdk.getById("user").value == "") {
		alert(wdk.msg("please input user"));
		return;
	}

	if (wdk.getById("password").value == "") {
		alert(wdk.msg("please input password"));
		return;
	}

	LOGIN = wdk.cliCmd("pandora get_login_status").replace("\n", "");

	if (LOGIN == "0") {
		wdk.showResultBG();

        _user = wdk.getById("user").value;
	    _passwd = wdk.getById("password").value;
	    _proxy = wdk.getById("proxy").value;
	    _license = wdk.getById("license").value;

		wdk.cdbSet('$pandora_user', _user);
		wdk.cdbSet('$pandora_password', _passwd);
		wdk.cdbSet('$pandora_proxy', _proxy);
		wdk.cdbSet('$pandora_license', _license);
		wdk.save_form(0, 1);

		wdk.cliCmd("pandora conf");
		wdk.cliCmd("pandora start");

		check_login_status();
	}
	check_button_state();
}

function logout() {
	stopsong();
	wdk.cliCmd("pandora shutdown");
	wdk.getById("stat_list").innerHTML = "";
	LOGIN = "0";
	check_button_state();
}

function init() {
	wdk.stopTimeout();
	wdk.getById("user").value = wdk.cdbVal('$pandora_user');
	wdk.getById("password").value = wdk.cdbVal('$pandora_password');
	wdk.getById("proxy").value = wdk.cdbVal('$pandora_proxy');
	wdk.getById("license").value = wdk.cdbVal('$pandora_license');

	LOGIN = wdk.cliCmd("pandora get_login_status").replace("\n", "");

	if (LOGIN == "1") {
		play_station = parseInt(wdk.cliCmd("pandora get_station_idx"));
		show_stations();
		show_info();
	}
	check_button_state();
}

function show_stations() {
	var content = "";
	var stations = wdk.cliCmd("pandora get_stations").replace("\n", "");

	if (stations != "") {
		station_list = stations.split(";");

		content += "<table>"
		for (var i = 0; i < station_list.length; i++) {
			content += "<tr>"
			content += "<td width=70% align=center>" + station_list[i] + "<" + "/td>"
			content += "<td width=30% align=center><img src= images/rsPlay.jpg width=14 height=14 onclick=playsong(" + i + ")><" + "/td>"
			content += "<" + "/tr>"
		}
		content += "<" + "/table>"

		wdk.getById("stat_list").innerHTML = content;
	}
}

function show_info() {
	var content = "";
	var vol = wdk.cliCmd("mpc volume").split(':');
	wdk.getById("volume_value").innerHTML = vol[vol.length - 1];
	play_station = parseInt(wdk.cliCmd("pandora get_station_idx"));

	content += "<table><tr>"

	if ((LOGIN == "1") && (station_list.length > 0)) {
		content += "<td width=10% align=right><b>Station:</b></td><td align=left>" + station_list[play_station] + "</td>"
	} else {
		content += "<td width=10% align=right><b>Station:</b></td><td align=left>None</td>"
	}

	content += "</tr><tr>"

	if (LOGIN == "1") {
		content += "<td width=10% align=right><b>Song:</b></td><td align=left>" + wdk.cliCmd("pandora get_play_song").trim(); + "</td>"
	} else {
		content += "<td width=10% align=right><b>Song:</b></td><td align=left>None</td>"
	}
	content += "</tr></table>"

	wdk.getById("play_song").innerHTML = content;

	if (LOGIN == "1") {
		setTimeout("show_info()", 3000);
	}
}

function playsong(station) {
	wdk.cliCmd("pandora play " + station);
}

function stopsong() {
	wdk.cliCmd("pandora stop");
}

function nextsong() {
	wdk.cliCmd("pandora next");
}

function volume(op) {
	if (op == "0") {
		wdk.cliCmd("pandora volume down");
	} else if (op == "1") {
		wdk.cliCmd("pandora volume up");
	}
}
 </script>
</head>

<body class="gui" onload="init()" onkeydown="(event.keyCode==13) ? 0 : 1">
 <script>
header()
 </script>
 <form name="form1">
  <table>
   <tr>
    <td width="70%">
     <fieldset>
      <legend>
       <script>
wdk.putmsg("Pandora Login")
       </script>
      </legend>
      <div class="setting">
       <label class="label">
        <script>
wdk.putmsg("User")
        </script>
       </label>
       <input id="user" type="text">
       <br>
       <label class="label">
        <script>
wdk.putmsg("Password")
        </script>
       </label>
       <input id="password" type="text">
       <br>
       <label class="label">
        <script>
wdk.putmsg("Proxy")
        </script>
       </label>
       <input id="proxy" type="text">
       <br>
       <label class="label">
        <script>
wdk.putmsg("License Key")
        </script>
       </label>
       <input id="license" type="text">
       <br>
       <center>
        <input id="lin" type="button" class="button" value="Login" onclick="login()">
        <input id="lout" type="button" class="button" value="Logout" onclick="logout()">
       </center>
      </div>
     </fieldset>
    </td>
    <td width="30%">
     <fieldset>
      <legend>
       <script>
wdk.putmsg("Volume")
       </script>
      </legend>
      <br>
      <br>
      <br>
      <center>
       <div id="volume_value"></div>
      </center>
      <br>
      <br>
      <br>
      <br>
      <center>
       <input type="button" value=" Up " onclick="volume(1)">
       <input type="button" value="Down" onclick="volume(0)">
      </center>
     </fieldset>
    </td>
    <tr>
  </table>
  <fieldset>
   <legend>
    <script>
wdk.putmsg("Play")
    </script>
   </legend>
   <p id="play_song" class="curPlay">
   </p>
   <br>
   <button type="button" onclick="stopsong()">
    <script>
wdk.putmsg("  Stop  ")
    </script>
   </button>
   <button type="button" onclick="nextsong()">
    <script>
wdk.putmsg("  Next  ")
    </script>
   </button>
  </fieldset>
  <fieldset>
   <legend>
    <script>
wdk.putmsg("Pandora Station Lists")
    </script>
   </legend>
   <table class="infolist">
    <thead>
     <tr>
      <th width="70%">
       <script>
wdk.putmsg("Station Name")
       </script>
      </th>
      <th width="30%">
       <script>
wdk.putmsg("Action")
       </script>
      </th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td colspan="2">
       <div id="stat_list" class="scrollit"></div>
      </td>
     </tr>
    </tbody>
   </table>
  </fieldset>
 </form>
 <br>
 <!--
	<div class="submitFooter" id="cmtRow">
		<input id="applyForm" type="button" class="button" value="OK" onclick="cmtRSPlayList()">
		<input id="notApplyForm" type="button" class="button" value="Cancel" onclick="location.reload()">
	</div>
	-->
 <div id="modalWindow" style="display:none; visibility:hidden" class="black_overlay">
  <div class="white_content">
   <img src="images/load.gif" alt="loading icon">
  </div>
 </div>
 <script>
footer(1)
 </script>

</html>
