<!--ifdef CONFIG_TFTPC-->
<!DOCTYPE HTML>
<HTML>

<head>
 <title>Panther</title>
 <META http-equiv=Content-Type content='text/html; charset=utf-8'>
 <SCRIPT src=common.js></SCRIPT>
 <SCRIPT src=wdk.js></SCRIPT>
 <SCRIPT src=product.js></SCRIPT>
 <SCRIPT>
wdk.cdbLoad(['$sys_tftpc']);
var tftp_mode;

var m1 = [
	"",
	"Please input a file for TFTP downloading.",
	"Please input a file for TFTP uploading."
];

var m2 = [
	"",
	"Do you want to download file from TFTP Server?",
	"Do you want to upload file to TFTP Server?"
];

var m3 = ["", "get", "put"];
var m4 = [
	"",
	"Downloading! Please wait....",
	"Uploading! Please wait...."
];

var m5 = [
	"",
	"Downloaded successfully!",
	"Uploaded successfully!"
];

function tftpprocess(n) {
	var f = document.frm;
	if (!f.FT[0].checked && !f.FT[1].checked) {
		alert("Please select file type!");
		return;
	}
	if (f.files.value == "") {
		alert(wdk.msg(m1[n]));
		highlight("miscFile");
		return;
	}
	if (!chkIpOrDomain(f.svrip, "TFTP Server")) {
		highlight("svrip");
		return;
	}
	if (confirm(wdk.msg(m2[n]))) {
		//$sys_tftpc=srv=192.168.0.1&file=cdb.txt&type=0
		var rule = "srv=" + f.svrip.value + "&file=" + trim(f.files.value) + "&type=" + (f.FT[0].checked ? 1 : 0);
		wdk.cdbSet('$sys_tftpc', rule);
		wdk.save_form(0, 1);
		wdk.cliCmd('http largepost');
		wdk.stopTimeout();
		wdk.showResultBG();
		wdk.getById("titleupwarng").innerHTML = wdk.msg(m4[n]);
		tftp_mode = n;
		setTimeout("real_submit()", 100); /* wait loading picture */
		var s = 'tftp ' + m3[n] + ' ' + f.svrip.value + ' ' + trim(f.files.value);
		wdk.cliCmd(s);
	}
	return;
}

function trim(str) {
	return str.slice(str.lastIndexOf('\\') + 1);
}

function real_submit() {
	wdk.showResultBG();
	wdk.getById("titleupwarng").innerHTML = wdk.msg(m4[tftp_mode]);
	//add delay to avoid not yet submit
	setTimeout(function() {
		wdk.showUpgradeResult(0, result_success, result_fail,false);
	}, 1000);
}

function result_success() {
	wdk.getById("titleupwarng").innerHTML = wdk.msg(m5[tftp_mode]);
	setTimeout(function() {
		reboot();
	}, 1000);
}

function result_fail() {
	var bkstr = wdk.msg("Failed! Please check the firmware image and tool.") + '<br><br><input class=button name=apply_button value=' + wdk.msg("Back") + ' type=button onclick=javascript:onClick=goUrl("upgrade.htm")>'
	wdk.getById("result").innerHTML = bkstr;
}

function init() {}
 </SCRIPT>

 <link rel=stylesheet type=text/css href=demo2.css>
</HEAD>

<body class=gui onload=init() onkeydown="(event.keyCode==13) ? 0 : 1">
 <script>
header()
 </script>
 <form name=frm method=post target=save_frame encType=multipart/form-data>
  <fieldset>
   <legend>
    <script>
wdk.putmsg("TFTP Client");
    </script>
   </legend>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("File Type");
     </script>
    </div>
    <input id=t1 type=radio value=1 name=FT>
    <script>
wdk.putmsg("Firmware");
    </script>
    <input id=t0 type=radio value=0 name=FT>
    <script>
wdk.putmsg("Configuration");
    </script>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("File");
     </script>
    </div>
    <input id=miscFile type=text name=files maxlength=60>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Server");
     </script>
    </div>
    <input type=text name=svrip id=svrip maxlength=60>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Action");
     </script>
    </div>
    <script>
puts('<input type=button class=button name=tftpget value="' + wdk.msg('Download') + '" onclick=tftpprocess(1)>');
    </script>
   </div>
   <div class=setting>
    <div class=label>&nbsp;</div>
    <script>
puts('<input type=button class=button name=tftpput value="' + wdk.msg('Upload') + '" onclick=tftpprocess(2)>');
    </script>
   </div>
  </fieldset>
  <iframe id=save_frame name=save_frame src=# style="width:0;height:0;border:0px solid #fff;"></iframe>

  <script>
footer(1)
  </script>
 </form>

</html>
<!--endif-->
