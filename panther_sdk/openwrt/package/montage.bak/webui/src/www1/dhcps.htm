<!DOCTYPE HTML>
<HTML>

<head>
 <title>Panther</title>
 <META http-equiv=Content-Type content='text/html; charset=utf-8'>
 <SCRIPT src=common.js></SCRIPT>
 <SCRIPT src=wdk.js></SCRIPT>
 <SCRIPT src=product.js></SCRIPT>
 <SCRIPT>
wdk.cdbLoad(['$dhcps_enable', '$dhcps_start', '$dhcps_end', '$dhcps_lease_time', '$lan_ip', '$dns_enable', 'status wan_ip', '$dhcps_probe']);

var netip = wdk.cdbVal('$lan_ip').replace(/\.\d+$/, ".");
var wanip = wdk.cdbVal('status wan_ip');
var currentHost = window.location.host;

function save_ip(t) {
	return netip + t.value;
}

function init() {
	var f = document.frm;
	wdk.addLoadAttributeByID('$dhcps_start', ip_lsb);
	wdk.addSaveAttributeByID('$dhcps_start', save_ip);
	wdk.addLoadAttributeByID('$dhcps_end', ip_lsb);
	wdk.addSaveAttributeByID('$dhcps_end', save_ip);
	wdk.init_form();
}

function apply() {
	var f = document.frm;
	var ip_str;
	var lanip = f.lanip.value;

	if (!chkIP(f.lanip, "IP Address")) {
		highlight("$lan_ip");
		return;
	}
	if (lanip == wanip) {
		alert(wdk.msg("LAN IP address can't be the same with WAN IP address !"));
		highlight("$lan_ip");
		return;
	}

	if (!chkNum(f.dips, 1, 254, "IP Pool Starting Address")) {
		highlight("$dhcps_start");
		return;
	}
	if (!chkNum(f.dipe, 1, 254, "IP Pool Ending Address")) {
		highlight("$dhcps_end");
		return;
	}
	if (Number(f.dips.value) > Number(f.dipe.value)) {
		alert(wdk.msg("IP Pool Starting Address should not be greater than IP Pool Ending Address !"));
		highlight("$dhcps_start");
		return;
	}
	if (f.dhen.checked && (Number(lanip.match(/\d+$/)) >= Number(f.dips.value)) && (Number(lanip.match(/\d+$/)) <= Number(f.dipe.value))) {
		alert(wdk.msg("LAN IP address should not in the range of IP Pool Address !"));
		highlight("$lan_ip");
		return;
	}

	//update netip, make DHCPS start & end address be updated
	netip = lanip.replace(/\.\d+$/, ".");

	ip_str = getIP(f.lanip);
	wdk.setThisPage("http://" + ip_str + "/");
	if (window.confirm(wdk.msg("Device will reboot automatically! If web page didn't refresh automatically, please reload again!"))) {
		//wdk.showResultBG();
		//reboot();
		wdk.save_form(0, 1);
	}
}
 </SCRIPT>

 <link rel=stylesheet type=text/css href=demo2.css>
</HEAD>

<body class=gui onload=init() onkeydown="(event.keyCode==13) ? 0 : 1">
 <script>
header()
 </script>
 <form name=frm>
  <fieldset>
   <legend>
    <script>
wdk.putmsg("Settings")
    </script>
   </legend>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('IP Address')
     </script>
    </div>
    <input maxLength=15 name=lanip id=$lan_ip size=15>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('Subnet Mask')
     </script>
    </div>
    255.255.255.0
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('The Gateway acts as DHCP Server')
     </script>
    </div>
    <input type=checkbox name=dhen id=$dhcps_enable>
    <script>
wdk.putmsg('Enabled')
    </script>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('IP Pool Starting Address')
     </script>
    </div>
    <SCRIPT>
puts(netip)
    </SCRIPT>
    <input name=dips id=$dhcps_start class=num maxlength=3 size=3>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('IP Pool Ending Address')
     </script>
    </div>
    <SCRIPT>
puts(netip)
    </SCRIPT>
    <input name=dipe id=$dhcps_end class=num maxlength=3 size=3>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('Lease Time')
     </script>
    </div>
    <select name=dhlt id=$dhcps_lease_time SIZE=1>
     <option VALUE=1800>
      <script>
wdk.putmsg('Half hour')
      </script>
     </option>
     <option VALUE=3600>
      <script>
wdk.putmsg('One hour')
      </script>
     </option>
     <option VALUE=7200>
      <script>
wdk.putmsg('Two hours')
      </script>
     </option>
     <option VALUE=28800>
      <script>
wdk.putmsg('Eight hours')
      </script>
     </option>
     <option VALUE=43200>
      <script>
wdk.putmsg('Half day')
      </script>
     </option>
     <option VALUE=86400>
      <script>
wdk.putmsg('One day')
      </script>
     </option>
     <option VALUE=172800>
      <script>
wdk.putmsg('Two days')
      </script>
     </option>
     <option VALUE=604800>
      <script>
wdk.putmsg('One week')
      </script>
     </option>
     <option VALUE=1209600>
      <script>
wdk.putmsg('Two weeks')
      </script>
     </option>
     <option VALUE=315360000>
      <script>
wdk.putmsg('Forever')
      </script>
     </option>
    </select>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('DNS Proxy')
     </script>
    </div>
    <input type=checkbox name=DNSEN id=$dns_enable value=1>
    <script>
wdk.putmsg('Enabled')
    </script>
   </div>
   <!--ifdef CONFIG_DHCPS_PROBE-->
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg('DHCP Server probe')
     </script>
    </div>
    <input type=checkbox name=dh_probe id=$dhcps_probe value=1>
    <script>
wdk.putmsg('Enabled')
    </script>
   </div>
   <!--endif-->
  </fieldset>

  <script>
footer()
  </script>
 </form>

</html>
