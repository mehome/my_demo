<!--ifdef CONFIG_WEBCAM_IMAGE_PARAMETERS-->
<!DOCTYPE HTML>
<HTML>

<head>
 <title>Panther</title>
 <META http-equiv=Content-Type content='text/html; charset=utf-8'>
 <SCRIPT src=common.js></SCRIPT>
 <SCRIPT src=wdk.js></SCRIPT>
 <SCRIPT src=product.js></SCRIPT>
 <SCRIPT>
wdk.cdbLoad(['$webcam_format', '$webcam_mirror', '$webcam_flip', '$webcam_h264_mode', '$webcam_h264_qp', '$webcam_h264_bitrate', '$webcam_h264_qlvl', '$webcam_mjpg_bitrate', '$webcam_mjpg_qlvl']);

function modechange(m) {
	var qp = wdk.getById("$webcam_h264_qp");
	var br = wdk.getById("$webcam_h264_bitrate");
	if (m == 1) { //CBR
		qp.value = wdk.cdbVal("$webcam_h264_qp");
		updatebr(1, getSelectValue("$webcam_h264_qlvl"));
		showHide('br_div', 1);
		showHide('qp_div', 0);
	} else { //VBR
		br.value = wdk.cdbVal("$webcam_h264_bitrate");
		updatebr(1, getSelectValue("$webcam_h264_qlvl"));
		showHide('br_div', 0);
		showHide('qp_div', 1);
	}
}

function updatebr(t, ops) {
	var format = wdk.cdbVal('$webcam_format');
	var res = rule2var(format, "res");
	var fps = rule2var(format, "fps");
	var BFPS = 30;
	var MJBG_BR = [40000000, 25000000, 10000000];
	var H264_BR = [8000000, 4750000, 1500000];
	var H264_QP = [25, 32, 40];
	var res_div;
	if (ops == 255)
		return;
	if (res == "1920x1080")
		res_div = 1;
	else if (res == "1280x720")
		res_div = 2;
	else //640x480
		res_div = 6;
	if (t == 0) //mjpg
		wdk.getById("$webcam_mjpg_bitrate").value = Math.round(MJBG_BR[ops] / (BFPS / fps) / res_div);
	else { //h264
		if (getSelectValue("$webcam_h264_mode") == 1) { //CBR
			wdk.getById("$webcam_h264_bitrate").value = Math.round(H264_BR[ops] / (BFPS / fps) / res_div);
		} else { //VBR
			wdk.getById("$webcam_h264_qp").value = H264_QP[ops];
		}
	}
}

function init() {
	var f = document.frm;
	var format = wdk.cdbVal('$webcam_format');
	var target_ip = window.location.hostname;
	var port = rule2var(format, "port");
	var prot = (rule2var(format, "prot") == "HTTP") ? "http" : "rtsp";
	var path = rule2var(format, "path");
	var vdev = rule2var(format, "vdev");
	var url = prot + "://" + target_ip + ":" + port + "/" + path;
	var player_html = '<object classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921" codebase="http://downloads.videolan.org/pub/videolan/vlc/latest/win32/axvlc.cab" width="480" height="360" id="vlc"><param name="Src" value="' + url + '"><' + '/param><param name="AutoLoop" value="no"><' + '/param><param name="AutoPlay" value="yes"><' + '/param><embed type="application/x-vlc-plugin" pluginspage="http://www.videolan.org" id="vlcfirefox" autoplay="yes" loop="no" width="480" height="360" target="' + url + '"><' + '/embed><' + '/object>';

	wdk.getById("display").innerHTML = player_html;
	showHide("display", 1);

	f.reset();
	wdk.init_form();
	wdk.getById("$webcam_h264_mode").onchange();
}

function apply() {
	//check
	if (!chkNum(wdk.getById("$webcam_mjpg_bitrate"), 0, 4294967295, "MJPG Bitrate")) {
		highlight("$webcam_mjpg_bitrate");
		return;
	}
	if (!chkNum(wdk.getById("$webcam_h264_bitrate"), 0, 16777215, "H264 Bitrate")) {
		highlight("$webcam_h264_bitrate");
		return;
	}
	if (!chkNum(wdk.getById("$webcam_h264_qp"), 10, 51, "H264 Quantization Parameter")) {
		highlight("$webcam_h264_qp");
		return;
	}

	if (wdk.is_form_update()) {
		//show prompt message
		showHide('display', 0);
		wdk.showResultBG();
		wdk.redirect(5);

		//send new cdb variable setting
		wdk.save_form(0, 1);

		// sent commands
		if (wdk.cdbChg("$webcam_mirror")) {
			/*WSIM_BEGIN*/
			alert("webcam img_exctl mirror " + wdk.cdbVal("$webcam_mirror"));
			/*WSIM_END*/
			wdk.cliCmd("webcam img_exctl mirror " + wdk.cdbVal("$webcam_mirror"));
		}
		if (wdk.cdbChg("$webcam_flip")) {
			/*WSIM_BEGIN*/
			alert("webcam img_exctl flip " + wdk.cdbVal("$webcam_flip"));
			/*WSIM_END*/
			wdk.cliCmd("webcam img_exctl flip " + wdk.cdbVal("$webcam_flip"));
		}
		if (wdk.cdbChg("$webcam_h264_mode")) {
			/*WSIM_BEGIN*/
			alert("webcam img_exctl h264_mode " + wdk.cdbVal("$webcam_h264_mode"));
			/*WSIM_END*/
			wdk.cliCmd("webcam img_exctl h264_mode " + wdk.cdbVal("$webcam_h264_mode"));
		}
		if (wdk.cdbChg("$webcam_h264_qp")) {
			/*WSIM_BEGIN*/
			alert("webcam img_exctl h264_qp " + wdk.cdbVal("$webcam_h264_qp"));
			/*WSIM_END*/
			wdk.cliCmd("webcam img_exctl h264_qp " + wdk.cdbVal("$webcam_h264_qp"));
		}
		if (wdk.cdbChg("$webcam_h264_bitrate")) {
			/*WSIM_BEGIN*/
			alert("webcam img_exctl h264_bitrate " + wdk.cdbVal("$webcam_h264_bitrate"));
			/*WSIM_END*/
			wdk.cliCmd("webcam img_exctl h264_bitrate " + wdk.cdbVal("$webcam_h264_bitrate"));
		}
		if (wdk.cdbChg("$webcam_mjpg_bitrate")) {
			/*WSIM_BEGIN*/
			alert("webcam img_exctl mjpg_bitrate " + wdk.cdbVal("$webcam_mjpg_bitrate"));
			/*WSIM_END*/
			wdk.cliCmd("webcam img_exctl mjpg_bitrate " + wdk.cdbVal("$webcam_mjpg_bitrate"));
		}
	} else
		alert(wdk.msg('The settings are not changed!!'));
}
 </SCRIPT>

 <link rel=stylesheet type=text/css href=demo2.css>
</HEAD>

<body class=gui onload=init() onkeydown="(event.keyCode==13) ? 0 : 1">
 <script>
header()
 </script>
 <form name=frm>
  <fieldset>
   <legend>
    Image
    <script>
wdk.putmsg("Settings")
    </script>
   </legend>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Mirror")
     </script>
    </div>
    <input type=checkbox id=$webcam_mirror>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Flip")
     </script>
    </div>
    <input type=checkbox id=$webcam_flip>
   </div>
  </fieldset>
  <br>
  <fieldset>
   <legend>
    H264
    <script>
wdk.putmsg("Settings")
    </script>
   </legend>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Mode")
     </script>
    </div>
    <select id=$webcam_h264_mode size=1 onchange="modechange(this.value)">
     <option value='1'>CBR</option>
     <option value='2'>VBR</option>
    </select>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Quality")
     </script>
    </div>
    <select id=$webcam_h264_qlvl size=1 onchange="updatebr(1, this.value)">
     <option value='0'>High</option>
     <option value='1'>Middle</option>
     <option value='2'>Low</option>
     <option value='255'>Custom</option>
    </select>
   </div>
   <div class=setting id=qp_div>
    <div class=label>
     <script>
wdk.putmsg("Quantization Parameter")
     </script>
     &nbsp;(10~51)
    </div>
    <input id=$webcam_h264_qp onchange="setSelectValue('$webcam_h264_qlvl','255')">
   </div>
   <div class=setting id=br_div>
    <div class=label>
     <script>
wdk.putmsg("Bitrate")
     </script>
     &nbsp;(0~16777215)
    </div>
    <input id=$webcam_h264_bitrate onchange="setSelectValue('$webcam_h264_qlvl','255')">
   </div>
  </fieldset>
  <br>
  <fieldset>
   <legend>
    MJPG
    <script>
wdk.putmsg("Settings")
    </script>
   </legend>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Quality")
     </script>
    </div>
    <select id=$webcam_mjpg_qlvl size=1 onchange="updatebr(0, this.value)">
     <option value='0'>High</option>
     <option value='1'>Middle</option>
     <option value='2'>Low</option>
     <option value='255'>Custom</option>
    </select>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Bitrate")
     </script>
     &nbsp;(0~4294967295)
    </div>
    <input id=$webcam_mjpg_bitrate onchange="setSelectValue('$webcam_mjpg_qlvl','255')">
   </div>
  </fieldset>
  <br>
  <div id=display style="display:none;" align=center>
  </div>
  <script>
footer()
  </script>
 </form>

</html>
<!--endif-->
