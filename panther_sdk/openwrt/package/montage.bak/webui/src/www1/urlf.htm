<!DOCTYPE HTML>
<HTML>

<head>
 <title>Panther</title>
 <META http-equiv=Content-Type content='text/html; charset=utf-8'>
 <SCRIPT src=common.js></SCRIPT>
 <SCRIPT src=wdk.js></SCRIPT>
 <SCRIPT src=product.js></SCRIPT>
 <SCRIPT>
wdk.cdbLoad(['$lan_ip', '$fw_urlf_mode', '$fw_urlf1-20']);

var max = 20;
var netip = subNet(wdk.cdbVal("$lan_ip"));
var listnum
var curIdx = -1;

function init() {
	var f = document.frm;
	listnum = wdk.cdbLen('$fw_urlf', max); //The number of row which we want to create.
	refreshList('$fw_urlf', max, listnum); //Copy empty rows.
	wdk.getById('usage').innerHTML = listnum + '/' + max;
	f.reset();
	wdk.init_form();
	showHide('fwurl_tab', Number(wdk.cdbVal('$fw_urlf_mode')));
}

function change_init() {
	wdk.presubmit_form();
	init();
}

function ip() {
	puts(netip);
}

function ip_lsb(s, rng) {
	var ip = rng.split('-');
	var all = wdk.findChildNode(s.parentNode);
	var sip = wdk.getAllByName(all, 'sip');
	sip[0].value = ip[0].match(/\d+$/);
	sip[1].value = ip[1].match(/\d+$/);
}

function change(add) {
	var r = '';
	var tab1 = wdk.findChildNode(wdk.getById('edit'));
	var sip = wdk.getAllByName(tab1, 'sip');
	var url = wdk.getByName(tab1, 'str');
	var en = wdk.getByName(tab1, 'en');

	if (!chkNum(sip[0], 1, 254, "IP Address")) {
		sip[0].focus();
		return;
	}
	if (!chkNum(sip[1], 1, 254, "IP Address")) {
		sip[1].focus();
		return;
	}
	if (Number(sip[0].value) > Number(sip[1].value)) {
		alert(wdk.msg("IP Pool Starting Address should not be greater than IP Pool Ending Address !"));
		sip[0].focus();
		return;
	}
	if (!chkUrl(url, "URL filter string")) {
		url.focus();
		return;
	}

	for (var i = 1; i <= listnum; i++) {
		if (!add && i == curIdx) continue;
		/*	if (wdk.cdbVal('$fw_urlf'+i).indexOf('gp='+gp.value+'&') > -1)
		{
			alert("Duplicated port range!!");
			return;
		}*/
	}
	r = 'en=' + Number(en.checked) + '&str=' + url.value + '&sip=' + netip + sip[0].value + '-' + netip + sip[1].value

	var k = curIdx;
	if (add) {
		k = listnum + 1;
		if (k > max) {
			alert(wdk.msg("Too many entries, maximum is ") + max);
			return
		}
	}

	wdk.cdbSet('$fw_urlf' + k, r);
	change_init();
}

function edit(idx) {
	var r = wdk.cdbVal('$fw_urlf' + idx);
	r = (r == '') ? 'en=0&str=&sip=' : r;
	wdk.fill_form_entry(wdk.getById('edit'), r);
	markEntry(wdk.getById('$fw_urlf' + idx));
	curIdx = idx;
}

function Remove(idx) {
	wdk.cdbDel('$fw_urlf' + idx, max);
	if (curIdx > 2)
		curIdx--;
	change_init();
}

function apply() {
	wdk.save_form(2000);
}
 </SCRIPT>

 <link rel=stylesheet type=text/css href=demo2.css>
</HEAD>

<body class=gui onload=init() onkeydown="(event.keyCode==13) ? 0 : 1">
 <script>
header()
 </script>
 <form name=frm>
  <fieldset>
   <legend>
    <script>
wdk.putmsg("Settings")
    </script>
   </legend>
   <div class=setting>
    <div class=col31>
     <script>
wdk.putmsg("URL Filter Control")
     </script>
    </div>
    <select name=check id=$fw_urlf_mode size=1 onchange="showHide('fwurl_tab',Number(this.value))">
     <option value=0>
      <script>
wdk.putmsg("Disable URL Filter function")
      </script>
     </option>
     <option value=1>
      <script>
wdk.putmsg("Deny Internet access for the following URL addresses")
      </script>
     </option>
     <option value=2>
      <script>
wdk.putmsg("Allow Internet access for the following URL addresses")
      </script>
     </option>
    </select>
   </div>
   <div id=fwurl_tab>
    <div id=edit>
     <div class=setting>
      <div class=col31>
       <script>
wdk.putmsg("IP Address")
       </script>
      </div>
      <div>
       <script>
ip()
       </script>
       <input placeholder="1" maxLength=3 name=sip load=ip_lsb size=3>~
       <input placeholder="254" maxLength=3 name=sip size=3>
      </div>
     </div>
     <div class=setting>
      <div class=col31>
       <script>
wdk.putmsg("URL filter string")
       </script>
      </div>
      <input placeholder="Filter off strings containing words like: violence, steal, sex, drug..." maxLength=128 name=str size=44>
     </div>
     <div class=setting>
      <div class=col31>
       <script>
wdk.putmsg("Enable")
       </script>
      </div>
      <input type=checkbox name=en value=1>
     </div>
     <div class=setting>
      <center>
       <script>
puts('<input type=button class=button name=Add value="' + wdk.msg('Add') + '" onclick=change(1)>' +
	'<input type=button class=button name=Mod value="' + wdk.msg('Modify') + '" onclick=change(0)>');
       </script>
      </center>
     </div>
     <div class=setting>
      <div class=col31>
       <script>
wdk.putmsg("Rules Listing")
       </script>
      </div>
      <div class=col3r><span id=usage></span>
       <script>
wdk.putmsg(" (using/max)")
       </script>
      </div>
     </div>
     <div class=floatKiller></div>
     <hr>
    </div>
    <table class=infolist>
     <tr>
      <th width=4%>
      </th>
      <th width=40%>
       <script>
wdk.putmsg("IP Address")
       </script>
      </th>
      <th width=46%>
       <script>
wdk.putmsg("URL filter string")
       </script>
      </th>
      <th width=10%>
       <script>
wdk.putmsg("Action")
       </script>
      </th>
     </tr>
     <tr align=center id=$fw_urlf1>
      <td nowrap>
       <input type=checkbox name=en disabled>
      </td>
      <td>
       <input name=sip disabled size=28>
      </td>
      <td>
       <input name=str disabled size=33>
      </td>
      <td>
       <img src=images/edit.gif width=15 height=17 border=0 alt=edit onclick=edit(this.parentNode.parentNode.rowIndex)>&nbsp;
       <img src=images/trash.gif width=15 height=17 border=0 alt=del onclick=Remove(this.parentNode.parentNode.rowIndex)>
      </td>
     </tr>
    </table>
   </div>
  </fieldset>

  <script>
footer()
  </script>
 </form>

</html>
