<!DOCTYPE html>
<html>

<head>
 <title>Panther(Mobile Version)</title>
 <meta http-equiv="cache-control" content="no-cache">
 <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
 <meta content="width=device-width, height= device-height, initial-scale=1, maximum-scale=4, user-scalable=yes" name="viewport" />
 <link href="pics/homescreen.gif" rel="apple-touch-icon" />
 <link href="css/style.css" rel="stylesheet" media="screen" type="text/css" />
 <link href="css/demo2.css" rel="stylesheet" media="screen" type="text/css" />
 <script type="text/javascript" src="javascript/common.js"></script>
 <script type="text/javascript" src="javascript/wdk.js"></script>
 <script type="text/javascript" src="javascript/product.js"></script>
 <script type="text/javascript" src="javascript/wrap_function.js"></script>
 <script type="text/javascript">
var param = [
	'$pandora_user',
	'$pandora_password',
	'$pandora_proxy',
	'$pandora_license'
];

var LOGIN = "0";
var check_login = 0;

var mainObj = new dataObject();
mainObj.get_config_obj(param);

var pandoraCfg = {
	'user': mainObj.config_val('$pandora_user'),
	'password': mainObj.config_val('$pandora_password'),
	'proxy': mainObj.config_val('$pandora_proxy'),
	'license': mainObj.config_val('$pandora_license'),
};

function sleep(milliseconds) {
	var start = new Date().getTime();
	for (var i = 0; i < 1e7; i++) {
		if ((new Date().getTime() - start) > milliseconds) {
			break;
		}
	}
}

function check_login_status() {
	check_login++;

	LOGIN = wdk.cliCmd("pandora get_login_status").replace("\n", "");

	if (LOGIN == "1") {
		sleep(1000);
		playsong(0);
		check_login = 0;
		goUrl("pandora_play.htm");
		return;
	}

	if (check_login < 20) {
		setTimeout("check_login_status()", 1000);
	} else {
		wdk.hideResultBG();
		check_login = 0;
		alert(wdk.msg("login fail, please check internet connection and account information."));
		window.location.reload();
	}
}

function login() {
	if (get_by_id("user").value == "") {
		alert(wdk.msg("please input user"));
		return;
	}

	if (get_by_id("password").value == "") {
		alert(wdk.msg("please input password"));
		return;
	}

	var user = get_by_id("user").value;
	var password = get_by_id("password").value;
	var proxy = get_by_id("proxy").value;
	var license = get_by_id("license").value;
	LOGIN = wdk.cliCmd("pandora get_login_status").replace("\n", "");

	if (LOGIN == "0") {
		mainObj.config_set(user, '$pandora_user');
		mainObj.config_set(password, '$pandora_password');
		mainObj.config_set(proxy, '$pandora_proxy');
		mainObj.config_set(license, '$pandora_license');

		wdk.save_form(0, 1);
		wdk.showResultBG();
		wdk.cliCmd("pandora conf");
		wdk.cliCmd("pandora start");
		check_login_status();
	}
}

function init() {
	get_by_id("user").value = pandoraCfg.user;
	get_by_id("password").value = pandoraCfg.password;
	get_by_id("proxy").value = pandoraCfg.proxy;
	get_by_id("license").value = pandoraCfg.license;

	LOGIN = wdk.cliCmd("pandora get_login_status").replace("\n", "");

	if (LOGIN == "1") {
		goUrl("pandora_play.htm");
	}
}
 </script>
</head>

<body onload=init()>
 <div id="resultbg" style="display:none;" class="black_overlay">
  <div id="result" class="white_content">
   <img src="images/load.gif" alt="loading icon" />
   <div><font id="titleupwarng"></font>
   </div>
  </div>
 </div>

 <form id="form1" name="form1" method="post" action="">
  <div id="topbar">
   <div id="leftnav">
    <a href="index.htm">
     <img alt="home" src="images/back.gif" />
    </a>
   </div>
   <div id="title">Pandora Login</div>
   <div id="rightbutton">
    <a href="#" onclick="login()">
     <script>
show_words("Login")
     </script>
    </a>
   </div>
  </div>

  <div id="content">
   <ul class="pageitem">
    <li class="smallfield">
     <span class="name"><script>get_words("User")</script></span>
     <input name="user" id="user" type="text">
    </li>
    <li class="smallfield">
     <span class="name"><script>get_words("Password")</script></span>
     <input name="password" id="password" type="text">
    </li>
    <li class="smallfield">
     <span class="name"><script>get_words("Proxy")</script></span>
     <input name="proxy" id="proxy" type="text">
    </li>
    <li class="smallfield">
     <span class="name"><script>get_words("License Key")</script></span>
     <input name="license" id="license" type="text">
    </li>
   </ul>
  </div>
 </form>
</body>

</html>
