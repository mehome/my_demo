<!DOCTYPE HTML>
<HTML>

<head>
 <title>Panther</title>
 <META http-equiv=Content-Type content='text/html; charset=utf-8'>
 <SCRIPT src=common.js></SCRIPT>
 <SCRIPT src=wdk.js></SCRIPT>
 <SCRIPT src=product.js></SCRIPT>
 <SCRIPT src=md5.js></SCRIPT>
 <SCRIPT>
wdk.cdbLoad(['$sys_user1', '$sys_idle', '$sys_remote_enable', '$sys_remote_ip', '$sys_remote_port', '$nat_dmz_enable'
]);

var opass;
var ouser = rule2var(wdk.cdbVal('$sys_user1'), "user");
var cdb_digest_pass = rule2var(wdk.cdbVal('$sys_user1'), "pass2");
var cdb_pass = rule2var(wdk.cdbVal('$sys_user1'), "pass");

function init() {
	var f = document.frm;
	wdk.init_form();
	f.user.value = ouser;
	// if (Number(wdk.cdbVal('$nat_dmz_enable')) == 2)
	// 	f.RMEN.disabled = true;
	// else
	// 	f.RMEN.disabled = false;

		f.pass.value = f.opass.value = f.pass2.value = opass = cdb_pass;
}

function passChanged(p1, p2, p3) {
	if (p1.value != opass || p2.value != opass || p3.value != opass)
		return 1;
	else
		return 0;
}

function passHash(ps) {
	var h = hex_md5(ps);
	return h;
}

function apply() {
	var f = document.frm;
	var ohash = f.opass.value;
	var nhash;
	//alert(authMode);
	if (f.idle.value == '') {
		alert(wdk.msg("Idle Time Out") + wdk.msg(" must input a value !"));
		highlight("$sys_idle");
		return;
	}
	if (f.idle.value != 0)
		if (!chkNum(f.idle, 60, 3600, "Idle Time Out")) {
			highlight("$sys_idle");
			return;
		}
		// if (!chkIpOrNull(f.ip, "IP address")) {
		// 	highlight("$sys_remote_ip");
		// 	return;
		// }
		// if (!chkNum(f.port, 1, 65535, "Port")) {
		// 	highlight("$sys_remote_port");
		// 	return;
		// }


	if (!chkStr(f.user, "User Name") || !chkStrNoNull(f.user, "User Name")) {
		highlight("UserName");
		return;
	} //User Name can't be empty, too.
	if (passChanged(f.pass, f.pass2, f.opass)) {
			{
				if (f.opass.value != opass)
					ohash = passHash(f.opass.value);
			}
			if (!chkPassIsSame(opass, ohash, "Original password is not correct!")) {
				highlight("opass");
				return;
			}
			if (!chkStrLen(f.pass, 0, 12, "Password")) {
				highlight("pass");
				return;
			}
			if (!chkPass(f.pass, f.pass2, f.changed, "New input password is not consistent!")) {
				highlight("pass2");
				return;
			}
			nhash = passHash(f.pass.value);
			var r = 'user=' + f.user.value + '&pass=' + nhash;
	} else {
		var r = 'user=' + f.user.value + '&pass=' + opass;
	}
	wdk.cdbSet('$sys_user1', r);
	var dt;
	dt = 2000;
	wdk.save_form(dt);
}
 </SCRIPT>

 <link rel=stylesheet type=text/css href=demo2.css>
</HEAD>

<body class=gui onload=init() onkeydown="(event.keyCode==13) ? 0 : 1">
 <script>
header()
 </script>
 <form name=frm>
  <fieldset>
   <legend>
    <script>
wdk.putmsg("Login Account");
    </script>
   </legend>
   <input type=hidden name=changed value=0>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("User Name");
     </script>
    </div>
    <input id="UserName" name=user size=17 maxlength=12>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Current Password");
     </script>
    </div>
    <input type=password id=opass name=opass size=17 maxlength=12 onFocus=chkPassInput2(this,pass,pass2,changed);>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("New Password");
     </script>
    </div>
    <input type=password id=pass name=pass size=17 maxlength=12 onFocus=chkPassInput2(this,opass,pass2,changed);>
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Re-type Password");
     </script>
    </div>
    <input type=password id=pass2 name=pass2 size=17 maxlength=12 onFocus=chkPassInput2(this,opass,pass,changed);>
    <!--script>puts(' (4-12'+wdk.msg(' characters')+')');</script-->
   </div>
   <div class=setting>
    <div class=label>
     <script>
wdk.putmsg("Idle Time Out");
     </script>(60-3600)</div>
    <input name=idle id=$sys_idle size=4 maxlength=4>&nbsp;
    <script>
wdk.putmsg("seconds (0: No timeout)");
    </script>
   </div>
  </fieldset>

  <div style="display:none">
   <br>
   <fieldset>
    <legend>
     <script>
wdk.putmsg("Remote Management");
     </script>
    </legend>
    <div class=setting>
     <div class=label>
      <script>
wdk.putmsg("Enabled");
      </script>
     </div>
     <input type=checkbox name=RMEN id=$sys_remote_enable>
    </div>
    <div class=setting>
     <div class=label>
      <script>
wdk.putmsg("IP Address");
      </script>
     </div>
     <input name=ip id=$sys_remote_ip size=17 maxlength=15>
    </div>
    <div class=setting>
     <div class=label>
      <script>
wdk.putmsg("Port");
      </script>
     </div>
     <input name=port id=$sys_remote_port size=5 maxlength=5>
    </div>

   </fieldset>
  </div>

  <script>
footer()
  </script>
 </form>

</html>
